<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>control </title>
</head>
<body>
    
    <h1>Manage Points</h1>
    <form id="pointForm">
        <input type="text" id="pointName" placeholder="Enter point name">
        <button type="submit">Add Point</button>
    </form>

    <h2>Points List</h2>
    <ul id="pointsList"></ul>

    <h1>Log Visit</h1>
    <form id="visitForm">
        <select id="pointSelect"></select>
        <button type="submit">Log Visit</button>
    </form>

    <h2>Visits</h2>
    <ul id="visitsList"></ul>

    <script>
        
        document.getElementById('pointForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const pointName = document.getElementById('pointName').value;
            await fetch('/points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: pointName })
            });
 document.getElementById('pointName').value = '';
            loadPoints();
            });
        
         document.getElementById('visitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const pointId = document.getElementById('pointSelect').value;
            await fetch('/visits', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pointId: pointId })
            });
            loadVisits();
        });
        
              async function loadPoints() {
            const response = await fetch('/points');
            const points = await response.json();
            const pointsList = document.getElementById('pointsList');
            const pointSelect = document.getElementById('pointSelect');
            pointsList.innerHTML = '';
            pointSelect.innerHTML = '';
            points.forEach((point, idx) => {
                pointsList.innerHTML += `<li>${point.name}</li>`;
                pointSelect.innerHTML += `<option value="${idx}">${point.name}</option>`;
            });
        }
             async function loadVisits() {
            const response = await fetch('/visits');
            const visits = await response.json();
            const visitsList = document.getElementById('visitsList');
            visitsList.innerHTML = '';
            visits.forEach((visit) => {
                visitsList.innerHTML += `<li>Point ID: ${visit.pointId}, Time: ${visit.timestamp}</li>`;
            });
        }
        
         async function deletePoint(idx) {
        await fetch(`/points/${idx}`, { method: 'DELETE' });
        loadPoints();  
    }
        
    async function loadPoints() {
        const response = await fetch('/points');
        const points = await response.json();
        const pointsList = document.getElementById('pointsList');
        const pointSelect = document.getElementById('pointSelect');
        pointsList.innerHTML = '';
        pointSelect.innerHTML = '';
        points.forEach((point, idx) => {
            pointsList.innerHTML += `
                <li>${point.name} 
                    <button onclick="deletePoint(${idx})">Delete</button>
                </li>`;
            pointSelect.innerHTML += `<option value="${idx}">${point.name}</option>`;
        });

        loadPoints();
        loadVisits();
    </script>
</body>
</html>
